---
title: "Crosswalk"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Crosswalk}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

### Program Overview

According to (US Department of Housing and Urban Development, n.d.), the
difficulty of linking United States Postal Service (USPS) ZIP codes to Census
Bureau regions is one of the many obstacles that social science scholars and
practitioners face. Only at the ZIP code level is there relevant data that, when
paired with demographic data calculated at various Census geographic levels,
could open up new paths of investigation.

Furthermore, the (US Department of Housing and Urban Development, n.d.) believes
that while there are several appropriate approaches for integrating ZIP codes
with Census geographies, they are limited. The HUD-USPS Crosswalk Files were
supplied by PD&R to enable more routes for integrating these data. These
one-of-a-kind files were created using data from the quarterly USPS Vacancy
Data. They come straight from the USPS; they're updated quarterly, so they're
always up to date with changes in ZIP code configurations; and they reflect both
commercial and residential addresses. Because many of the phenomena that housing
researchers study are based on housing unit or address, the latter attribute is
of special interest to them. Analysts can take into account not just the spatial
distribution of population, but also the spatial distribution of residences, by
utilizing an allocation approach based on residential addresses rather than by
area or population. This allows for a more sophisticated approach to data
allocation across different geographies.

These journal articles describe the problem and proposed solution in more detail: 



Wilson, Ron and Din, Alexander, 2018. “Understanding and Enhancing the U.S.
<br />&nbsp;&nbsp;&nbsp;&nbsp; Department of Housing and Urban Development’s ZIP Code Crosswalk Files,”
<br />&nbsp;&nbsp;&nbsp;&nbsp; Cityscape: A Journal of Policy Development and Research, Volume 20 Number 2, 277
 – 294. <br />&nbsp;&nbsp;&nbsp;&nbsp; https://www.huduser.gov/portal/periodicals/cityscpe/vol20num2/ch16.pdf



Din, Alexander and Wilson, Ron, 2020. "Crosswalking ZIP Codes to Census
<br />&nbsp;&nbsp;&nbsp;&nbsp; Geographies: Geoprocessing the U.S. Department of Housing & Urban Development’s
<br />&nbsp;&nbsp;&nbsp;&nbsp; ZIP Code Crosswalk Files," Cityscape: A Journal of Policy Development and
<br />&nbsp;&nbsp;&nbsp;&nbsp; Research, Volume 22, Number 1,
https://www.huduser.gov/portal/periodicals/cityscpe/vol22num1/ch12.pdf


### Census Geographies

This chart provided by the US Census Bureau gives a good example of the
relationships among different geographies. The crosswalk files only support a
subset of these.


### Examples

There are 12 main function calls for the Crosswalk files:
The package also contains a omni function which encapsulates the 
capabilities of all the main function calls mentioned below.
[onmi-function][Using the omni function for querying]

1) [zip-tract][Zip -> Tract]
2) [zip-county][Zip -> County]
3) [zip-cbsa (Core Base Statistical Areas)][Zip -> CBSA (Core Base Statistical Areas)]
4) [zip-cbsadiv (Available 4th Quarter 2017 onwards)][Zip -> CBSAdiv (Core Base Statistical Areas Division)]
5) [zip-cd (Congressional District)][ZIP -> CD (Congressional District)]
6) [tract-zip][Tract -> Zip]
7) [county-zip][County -> Zip]
8) [cbsa-zip][CBSA (Core Based Statistical Areas) -> Zip]
9) [cbsadiv-zip (Available 4th Quarter 2017 onwards)][CBSAdiv (Core Based Statistical Areas Division) -> Zip]
10) [cd-zip][CD (Congressional District) -> Zip]
11) [zip-countysub (Available 2nd Quarter 2018 onwards)][Zip -> County Subdistrict]
12) [countysub-zip (Available 2nd Quarter 2018 onwards)][County Subdistrict -> Zip]

The first GEOID type in the function call is what we want to query for. For
example in #1 above 'zip' is the first GEOID and 'tract' is the second GEOID.

The second GEOID in the function call describes the GEOID which we want to 
determine 'intersection' with the first GEOID where intersection is described
as the % of residential, business, other, and total buildings that overlap. 

For example, in function call #7, we might have a county called 22031 which has zip codes
71052, 71078, 71049, 71032 ... where the residential % of each zip is 0.38,
0.21, 0.11, 0.05... respectively. Of all these zips, when added up will equal 1,
signaling these grouping of zip codes make up 100% of residential address in the
county with each zip taking up their respective residential percentage.

Disclaimer: Although there exists inverse relationships in the Crosswalk Files,
the measurements are NOT DIRECTLY inverse -- for reasons stated within the papers
above.

These are basic examples which shows you to query the Crosswalk API. Before
looking at the outputted data I RECOMMEND first taking a look at [Input Arguments][]
as well as [Output Data][] located at the bottom of the page.

#### Zip -> Tract
```{r, eval = if(Sys.getenv("HUD_KEY") == "") FALSE else TRUE}
library(hudr)
# Four digits for printed output. 
options (digits=4)
hud_cw_zip_tract(zip = '35213', year = c('2010'), quarter = c('1'))
```
#### Zip -> County
```{r, eval = if(Sys.getenv("HUD_KEY") == "") FALSE else TRUE}
hud_cw_zip_county(zip = 35213, year = c('2020'), quarter = c('2'))
```
#### Zip -> CBSA (Core Base Statistical Areas)
```{r, eval = if(Sys.getenv("HUD_KEY") == "")  FALSE else TRUE}
hud_cw_zip_cbsa(zip = 35213, year = c('2011'), quarter = c('3'))
```
#### Zip -> CBSAdiv (Core Base Statistical Areas Division)
```{r, eval = if(Sys.getenv("HUD_KEY") == "")  FALSE else TRUE}
hud_cw_zip_cbsadiv(zip = '22031', year = c('2019'), quarter = c('4'))
```
#### ZIP -> CD (Congressional District)
```{r, eval = if(Sys.getenv("HUD_KEY") == "")  FALSE else TRUE}
hud_cw_zip_cd(zip = '35213', year = c(2011), quarter = c(1))
```
#### Tract -> Zip 
```{r, eval = if(Sys.getenv("HUD_KEY") == "")  FALSE else TRUE}
hud_cw_tract_zip(tract = 48201223100, year = c('2017'), quarter = c('1'))
```
#### County -> Zip 
```{r, eval = if(Sys.getenv("HUD_KEY") == "")  FALSE else TRUE}
hud_cw_county_zip(county = '22031', year = c('2010'), quarter = c('1'))
```
#### CBSA (Core Based Statistical Areas) -> Zip 
```{r, eval = if(Sys.getenv("HUD_KEY") == "")  FALSE else TRUE}
hud_cw_cbsa_zip(cbsa = '10140', year = c('2017'), quarter = c('2'))
```
#### CBSAdiv (Core Based Statistical Areas Division) -> Zip
```{r, eval = if(Sys.getenv("HUD_KEY") == "")  FALSE else TRUE}
hud_cw_cbsadiv_zip(cbsadiv = 10380, year = c('2017'), quarter = c('4'))
```
#### CD (Congressional District) -> Zip
```{r, eval = if(Sys.getenv("HUD_KEY") == "")  FALSE else TRUE}
hud_cw_cd_zip(cd = '2202', year = c('2010'), quarter = c('4'))
```
#### Zip -> County Subdistrict
```{r, eval = if(Sys.getenv("HUD_KEY") == "") FALSE else TRUE}
hud_cw_zip_countysub(zip = '35213', year = c('2019'), quarter = c('2'))
```
#### County Subdistrict -> Zip
```{r, eval = if(Sys.getenv("HUD_KEY") == "")  FALSE else TRUE}
hud_cw_countysub_zip(countysub = '4606720300 ', year = c('2019', '2019', '2019'), quarter = c('4','4'))
```

#### Querying for only the Crosswalked GEOIDs

If you just want the crosswalked GEOIDs, you can set the MINIMAL argument to TRUE.
This will return a vector containing the crosswalked GEOIDs without the extra metadata.

```{r, eval = if(Sys.getenv("HUD_KEY") == "") FALSE else TRUE }
hud_cw_county_zip(county = '22031', year = c('2010'), quarter = c('1'), minimal = TRUE)
```

### Using the omni function for querying

The omni function requires specifying the type which can be from 1-12. The type
argument follows the number scheme described at [Input Arguments][]. You also 
must use the 'query' argument for inputting geoids instead of the specific 
geoid names (i.e county = 22031, cd = 7200) used by the other functions.

```{r, eval = if(Sys.getenv("HUD_KEY") == "") FALSE else TRUE }
hud_cw(type = 7, query = '22031', year = c('2010'), quarter = c('1'))
```

### Input Arguments

**QUERY** 

The query argument name is the first geoid in the function call. 
For example, zip-county would have the 'zip' argument name as the query.

Functions #1-5 and #11 must specify a 5 digit zip code in the **zip** function
argument. (Can be a type of character or numeric)

  * zip = 22031

Function #6 must specify an 11 digit number consisting of state FIPS + county
FIPS + tract code tract in the **tract** function argument (Can be type of
character or numeric)

  * tract = 51059461700

Function #7 must specify a 5 digit county fips code in the **county** function
argument (Can be a type of character or numeric)
  
  * county = 51600

Function #8 must specify a micropolitan or metropolitan CBSA code in the
**cbsa** function argument. (Can be a type of character or numeric)
  
  * cbsa = 10380
  
Function #9 must specify a metropolitan CBSA division code in the
**cbsadiv** function argument. (Can be a type of character or numeric)
  
  * cbsadiv = 35614
  
I recommend typing hud_metropolitan("MD") to see a list of metropolitan CBSA in
Maryland. For example, a code of METRO22900N40079 needs 22900 inside as the input
argument. Micropolitan CBSA codes are allowed, but we currently do not know
how to query for it.

Function #10 must be a 2 digit state fips code + 2 digit congressional district 
code in the **cd** function argument. (Can be a type of character or numeric)
  
  * cd = 7200

Function #12 must be a 10 digit consisting of 5 digit county fips code + 5 digit
county sub district code in the **countysub** argument. (Can be a type of character or
numeric)

  * countysub = 4606720300
  
**YEAR**: Year range of the data to retrieve: defaults to the current year. (Can be
type of character or numeric)

  * year = c(2019, 2018, 2021)
  * year = c(2016)
  * year = 2021

**QUARTER**: The quarters in the year to retrieve: defaults to the first
quarter. (Can be a type of character or numeric)
  
  * quarter = c(1,2,3,4)
  * quarter = c(1)
  * quarter = 4

**MINIMAL**: If TRUE, returns just the intersecting GEOIDs that are 
crosswalked with the queried GEOID  

**KEY**: The API key provided by HUD.

  * key = "wqokqo2138jdi13wfwwfwcytjyr"


### Output Data 

1)  **zip/county/fipstract/cbsa/cbsadiv/cd/countysub**
    * The GEOID to query for


2) **res_ratio**  
    * The ratio of residential addresses in the ZIP – Tract, County, or CBSA
    part to the total number of residential addresses in the entire ZIP. (for
    type 1-5) The ratio of residential addresses in the Zip, Tract, County, or
    CBSA - ZIP part to the total number of residential addresses in the entire
    Zip, Tract, County, or CBSA. (for type 6-10)


3) **bus_ratio**
    * The ratio of business addresses in the ZIP – Tract, County, or CBSA part
    to the total number of business addresses in the entire ZIP. (for type 1-5).
    The ratio of business addresses in the Tract, County, or CBSA – ZIP part to
    the total number of business addresses in the entire Tract, County, or CBSA.
    (for type 6-10)


4) **oth_ratio** 
    * The ratio of other addresses in the ZIP – Tract to the total number of
    other addresses in the entire ZIP. (for type 1-5). The ratio of other 
    addresses in the Tract, County, or CBSA – ZIP part to the total number of
    other addresses in the entire Tract, County, or CBSA. (for type 6-10)


5) **tot_ratio** 
    * The ratio of all addresses in the ZIP – Tract to the total number of 
    all types of addresses in the entire ZIP. (for type 1-5) The ratio of all
    addresses in the Tract, County, or CBSA-ZIP part to the total number of all
    types of addresses in the entire Tract, County, or CBSA. (for type 6-10)
    

6) **zip/county/fipstract/cbsa/cbsadiv/cd/countysub**
    * The intersecting GEOID

    
7) **year**
    * Year the measurement was taken.


8) **quarter** 
    * Quarter of year when measurement was taken.


### References

Din, Alexander and Wilson, Ron, 2020. "Crosswalking ZIP Codes to Census 
<br />&nbsp;&nbsp;&nbsp;&nbsp; Geographies: Geoprocessing the U.S. Department of Housing & Urban Development’s
<br />&nbsp;&nbsp;&nbsp;&nbsp; ZIP Code Crosswalk Files," Cityscape: A Journal of Policy Development and
<br />&nbsp;&nbsp;&nbsp;&nbsp; Research, Volume 22, Number 1, https://www.huduser.gov/portal/periodicals/cityscpe/vol22num1/ch12.pdf

Katy Rossiter, K. R. (2014, July 31). Standard Hierarchy of Census Bereau
<br />&nbsp;&nbsp;&nbsp;&nbsp; Geographies [Photograph]. Understanding Geographic Relationships: Counties,
<br />&nbsp;&nbsp;&nbsp;&nbsp; Places, Tracts and More.
<br />&nbsp;&nbsp;&nbsp;&nbsp; https://www.census.gov/newsroom/blogs/random-samplings/2014/07/understanding-geographic-rela<br />&nbsp;&nbsp;&nbsp;&nbsp; tionships-counties-places-tracts-and-more.html

U.S Department of Housing and Urban Development. (n.d.). HUD USPS ZIP
<br />&nbsp;&nbsp;&nbsp;&nbsp; Code Crosswalk Files | HUD USER. HUD  USPS ZIP CODE CROSSWALK FILES.
<br />&nbsp;&nbsp;&nbsp;&nbsp; Retrieved February 17, 2022, from 
<br />&nbsp;&nbsp;&nbsp;&nbsp; https://www.huduser.gov/portal/datasets/usps_crosswalk.html

Wilson, Ron and Din, Alexander, 2018. “Understanding and Enhancing the U.S.
<br />&nbsp;&nbsp;&nbsp;&nbsp; Department of Housing and Urban Development’s ZIP Code Crosswalk Files,”
<br />&nbsp;&nbsp;&nbsp;&nbsp; Cityscape: A Journal of Policy Development and Research, Volume 20 Number 2, 277
– 294.
