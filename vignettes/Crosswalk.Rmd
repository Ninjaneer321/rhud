---
title: "Crosswalk"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Crosswalk}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

### Program Overview

"One of the many challenges that social science researchers and practitioners
face is the difficulty of relating United States Postal Service (USPS) ZIP codes
to Census Bureau geographies. There are valuable data available only at the
ZIP code level that, when combined with demographic data tabulated at various 
Census geography levels, could open up new avenues of exploration.

While some acceptable methods of combining ZIP codes and Census geography exist,
they have limitations. To provide additional avenues for merging these data,
PD&R has released the HUD-USPS Crosswalk Files. These unique files are derived
from data in the quarterly USPS Vacancy Data. They originate directly from the 
USPS; are updated quarterly, making them highly responsive to changes in ZIP
code configurations; and reflect the locations of both business and residential
addresses. The latter feature is of particular interest to housing researchers
because many of the phenomena that they study are based on housing unit or 
address. By using an allocation method based on residential addresses rather
than by area or by population, analysts can take into account not only the
spatial distribution of population, but also the spatial distribution of
residences. This enables a slightly more nuanced approach to allocating
data between disparate 
geographies (U.S Department of Housing and Urban Development, n.d.)."

These journal articles describe the problem and proposed solution in more detail: 

Wilson, Ron and Din, Alexander, 2018. “Understanding and Enhancing the U.S.
Department of Housing and Urban Development’s ZIP Code Crosswalk Files,”
Cityscape: A Journal of Policy Development and Research, Volume 20 Number 2, 277
– 294. https://www.huduser.gov/portal/periodicals/cityscpe/vol20num2/ch16.pdf

Din, Alexander and Wilson, Ron, 2020. "Crosswalking ZIP Codes to Census
Geographies: Geoprocessing the U.S. Department of Housing & Urban Development’s
ZIP Code Crosswalk Files," Cityscape: A Journal of Policy Development and
Research, Volume 22, Number 1,
https://www.huduser.gov/portal/periodicals/cityscpe/vol22num1/ch12.pdf

### Example

These are basic examples which shows you how to query the Crosswalk API.

```{r, eval = FALSE}
library(hudr)

hud_cw(type = 1, query = '35213', year = c('2010', '2011'), quarter = c('1'))

hud_cw(type = '2', query = '35213', year = c('2016', '2020'), quarter = c('2'))

hud_cw(type = 3, query = 35213, year = c('2012', '2011'), quarter = c('3'))

hud_cw(type = 4, query = '22031', year = c('2017', '2019'), quarter = c('4'))

hud_cw(type = '5', query = '35213', year = c(2011, '2012'), quarter = c('1','2'))

hud_cw(type = 6, query = '48201223100', year = c('2017', '2010'), quarter = c('1','2','3'))

hud_cw(type = 7, query = '22031', year = c('2010', '2011'), quarter = c('1'))

hud_cw(type = 8, query = '10140', year = c('2010', '2011'), quarter = c('2','1'))

hud_cw(type = 9, query = '10380', year = c('2017'), quarter = c('4'))

hud_cw(type = 10, query = '2202', year = c('2010', '2011'), quarter = c('4','3'))

hud_cw(type = 11, query = '35213', year = c('2019', '2020'), quarter = c('2','3'))

hud_cw(type = 12, query = '4606720300 ', year = c('2019', '2019', '2019'), quarter = c('4','4'))
```


### Input Arguments

**TYPE**: Must be a number between 1 and 12 depending on the Crosswalk type.
 
 1) zip-tract
 2) zip-county
 3) zip-cbsa
 4) zip-cbsadiv (Available 4th Quarter 2017 onwards)
 5) zip-cd
 6) tract-zip
 7) county-zip
 8) cbsa-zip
 9) cbsadiv-zip (Available 4th Quarter 2017 onwards)
 10) cd-zip
 11) zip-countysub (Available 2nd Quarter 2018 onwards)
 12) countysub-zip (Available 2nd Quarter 2018 onwards)

The first half of the 'type' argument describes the specific GEOID type we want
to query. The second half of the 'type' argument describe a secondary GEOID type
and how much it 'intersects' with the first region. For example, in type 7, we
might have a county called 22301 which has zip codes 35213, 13132, and 22411
which are either fully or partially inside the county 22301. Intersection is
describe in the % of residental, business, and other buildings in the second
half geoid that are in the first half geoid.

For example, 37% (A random number) of residential buildings in 22301 are from
35213 If all percentages of residential buildings in county 22301 are added up,
it should make up 100% consisting of (for example) 37% from 35213, 45% from
13132, and 18% from 22411.

**QUERY**: Depending on the type selected:
  
  1) 1-5 and 11 must specify a 5 digit zip code. 
    * query = 22031
  2) 6 must specify a 11 digit consisting of state FIPS + county FIPS + tract code tract. 
    * query = 51059461700
  3) 7 must specify a 5 digit county fip. 
    * query = 51600
  4) 8-9 must specify a micropolitan and metropolitan cbsa code. 
    * query = 10380
      I recommend typing hud_metropolitan() to see a list of metropolitan CBSA codes.
      For example, a code of METRO22900N40079 needs 22900 inside as the input argument.
  5) 10 must be a state fips code + congressional district 4 digit number 
    * query = 7200
  6) 12 must be a 10 digit consisting of 5 digit county fip + 5 digit county sub district.
    * query = 4606720300  
    
**YEAR**: Year range of the data to retrieve. Defaults to current year. Make sure 
the years provided follow the rules provided by the TYPE argument.

  * year = c(2019, 2018, 2021)
  * year = c(2016, 2017, 2022)
  * year = c(2021)

**QUARTER**: The quarters in the year to retrieve. Defaults to the first quarter.
  
  * quarter = c(1,2,3,4)
  * quarter = c(1)
  * quarter = 4
  
**KEY**: The API key provided by HUD.

  * key = "wqokqo2138jdi13wfwwfwcytjyr"

### Output Data 

1) **zip/county/fipstract/CBSA/Congressional District/County Subdistrict**
    * The first half of the 'type' argument


2) **year**
    * Year the measurement was taken.


3) **quarter** 
    * Quarter of year when measurement was taken.


4) **zip/county/fipstract/CBSA/Congressional District/County Subdistrict**
    * The second half of the 'type' argument


5) **res_ratio**  
    * The ratio of residential addresses in the ZIP – Tract, County, or CBSA
    part to the total number of residential addresses in the entire ZIP. (for
    type 1-5) The ratio of residential addresses in the Zip, Tract, County, or
    CBSA - ZIP part to the total number of residential addresses in the entire
    Zip, Tract, County, or CBSA. (for type 6-10)


6) **bus_ratio**
    * The ratio of business addresses in the ZIP – Tract, County, or CBSA part
    to the total number of business addresses in the entire ZIP. (for type 1-5).
    The ratio of business addresses in the Tract, County, or CBSA – ZIP part to
    the total number of business addresses in the entire Tract, County, or CBSA.
    (for type 6-10)


7) **oth_ratio** 
    * The ratio of other addresses in the ZIP – Tract to the total number of
    other addresses in the entire ZIP. (for type 1-5). The ratio of other 
    addresses in the Tract, County, or CBSA – ZIP part to the total number of
    other addresses in the entire Tract, County, or CBSA. (for type 6-10)


8) **tot_ratio** 
    * The ratio of all addresses in the ZIP – Tract to the total number of 
    all types of addresses in the entire ZIP. (for type 1-5) The ratio of all
    addresses in the Tract, County, or CBSA-ZIP part to the total number of all
    types of addresses in the entire Tract, County, or CBSA. (for type 6-10)


### References

Wilson, Ron and Din, Alexander, 2018. “Understanding and Enhancing the U.S.
Department of Housing and Urban    Development’s ZIP Code Crosswalk Files,”
Cityscape: A Journal of Policy Development and Research, Volume 20 Number 2, 277
– 294.

Din, Alexander and Wilson, Ron, 2020. "Crosswalking ZIP Codes to Census 
Geographies: Geoprocessing the U.S. Department of Housing & Urban Development’s
ZIP Code Crosswalk Files," Cityscape: A Journal of Policy Development and
Research, Volume 22, Number 1,                  https://www.huduser.gov/portal/periodicals/cityscpe/vol22num1/ch12.pdf

U.S Department of Housing and Urban Development. (n.d.). HUD USPS ZIP
Code Crosswalk Files | HUD USER. HUD  USPS ZIP CODE CROSSWALK FILES.
Retrieved February 17, 2022, from 
https://www.huduser.gov/portal/datasets/usps_crosswalk.html
